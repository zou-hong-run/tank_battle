var w=Object.defineProperty;var L=(n,e,s)=>e in n?w(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var f=(n,e,s)=>(L(n,typeof e!="symbol"?e+"":e,s),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function a(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();const u=class u{static getTankArr(){return u.tankArr}static getBulletArr(){return u.bulletArr}static getWallArr(){return u.wallArr}static pushTankToTankArr(e){u.tankArr.push(e)}static pushBulletToBulletArr(e){u.bulletArr.push(e)}static pushWallToWallArr(e){u.wallArr.push(e)}static removeTankFromMyTankArr(e){u.tankArr=u.tankArr.filter(s=>s!==e)}static removeBulletFromBulletArr(e){u.bulletArr=u.bulletArr.filter(s=>s!==e)}static removeWallFromWallArr(e){u.wallArr=u.wallArr.filter(s=>s!==e)}};f(u,"tankArr",[]),f(u,"bulletArr",[]),f(u,"wallArr",[]);let d=u;class D{createAudio(e="attack.mp3"){let s=document.createElement("audio");return s.src="./music/"+e,s}}class Y{constructor(e,s,a,i,r,o,l,m,c,k,y,E){this.height=e,this.width=s,this.posX=a,this.posY=i,this.level=r,this.blood=o,this.direction=l,this.speed=m,this.htmlEle=c,this.parent=k,this.mapEleName=y,this.game=E}setHeight(e){this.height=e}setWidth(e){this.width=e}setPosX(e){e<=0?this.posX=0:e>=this.game.mapWidth-this.getWidth()?this.posX=this.game.mapWidth-this.getWidth():this.posX=e}setPosY(e){e<=0?this.posY=0:e>=this.game.mapHeight-this.getHeight()?this.posY=this.game.mapHeight-this.getHeight():this.posY=e}setLevel(e){this.level=e}setBlood(e){if(this.blood=e,this.getMapEleName()===b.my){let s=document.querySelector("#myblood_content");s.innerHTML=e.toPrecision(4)+""}}setDirection(e){this.direction=e}setSpeed(e){this.speed=e}setHtmlEle(e){this.htmlEle=e}setMapEleName(e){this.mapEleName=e}getHeight(){return this.height}getWidth(){return this.width}getPosX(){return this.posX}getPosY(){return this.posY}getLevel(){return this.level}getBlood(){return this.blood}getDirection(){return this.direction}getSpeed(){return this.speed}getHtmlEle(){return this.htmlEle}getMapEleName(){return this.mapEleName}}class S extends Y{destroy(){var e,s;(s=(e=this.getHtmlEle())==null?void 0:e.parentElement)==null||s.removeChild(this.getHtmlEle()),d.removeBulletFromBulletArr(this)}move(){var c;let e=this.getPosX(),s=this.getPosY(),a=this.getPosX(),i=this.getPosY(),r=!1;if(this.game.randomBullet&&this.setDirection(h.getRandomDirection()),{up:()=>{i=this.getPosY()-this.getSpeed(),this.getPosY()<=0&&(r=!0)},down:()=>{i=this.getPosY()+this.getSpeed(),this.getPosY()>=this.game.mapHeight-this.getHeight()&&(r=!0)},left:()=>{a=this.getPosX()-this.getSpeed(),this.getPosX()<=0&&(r=!0)},right:()=>{a=this.getPosX()+this.getSpeed(),this.getPosX()>=this.game.mapWidth-this.getWidth()&&(r=!0)}}[this.getDirection()](),r)return this.destroy();this.setPosX(a),this.setPosY(i);let l=h.checkCollision(this,[d.getBulletArr()[0],d.getTankArr()[0],d.getWallArr()[0]]);if(!h.isNotHandleCollisionEle(this,l)&&l){((c=this.parent)==null?void 0:c.getMapEleName())===b.my&&this.game.music2&&this.game.music2.play(),this.destroy(),l.setBlood(l.getBlood()-5),l.getBlood()>0&&l.getBlood()<=100||l.destroy(this),h.addBlink(l.getHtmlEle());let k=l.getHtmlEle();k.innerText=l.getBlood().toPrecision(4)+""}else h.renderEle(this.getHtmlEle(),e,s,this.getDirection())}upgrade(){}}class W extends Y{destroy(){let e=document.querySelector("#enemynum_content");e.innerHTML=Number(e.innerHTML)+1+"",this.game.music1&&this.game.music1.play(),this.getMapEleName()===b.my?alert("洗白伊拉克，你被人搞死了"):console.log("其他坦克被弄死了"),d.removeTankFromMyTankArr(this);let s=this.getHtmlEle();s.style.backgroundImage="url('./assets/explosion.gif')",setTimeout(()=>{var v;(v=s.parentElement)==null||v.removeChild(this.getHtmlEle())},1e3);let a=Math.floor(Math.random()*(this.game.mapWidth/this.game.mapItemWidth))*this.game.mapItemWidth,i=0,r=this.game.mapItemWidth,o=this.game.mapItemHeight,l="up",m,c=.25,k=100,y=1,E=b.enemy1,p=this.game,P=this.game.renderMapEle(E,r,o,a,i,l,p,m,c,k,y);this.game.mapContainerEle.appendChild(P)}move(){let e=this.getPosX(),s=this.getPosY(),a=e,i=s,r=this.getHtmlEle(),o=!1,l={up:()=>{i=this.getPosY()-this.getSpeed(),this.getPosY()<=0&&(o=!0)},down:()=>{i=this.getPosY()+this.getSpeed(),this.getPosY()>=this.game.mapHeight-this.getHeight()&&(o=!0)},left:()=>{a=this.getPosX()-this.getSpeed(),this.getPosX()<=0&&(o=!0)},right:()=>{a=this.getPosX()+this.getSpeed(),this.getPosX()>=this.game.mapWidth-this.getWidth()&&(o=!0)}};if(this.getMapEleName()!==b.my&&((this.getPosX()<=0||this.getPosX()>=this.game.mapWidth-this.getWidth()||this.getPosY()<=0||this.getPosY()>=this.game.mapHeight-this.getHeight())&&this.setDirection(h.getRandomDirection()),this.shoot()),l[this.getDirection()](),o)return;this.setPosX(a),this.setPosY(i);let m=h.checkCollision(this,[d.getTankArr()[0],d.getWallArr()[0]]);!h.isNotHandleCollisionEle(this,m)&&m?(this.getMapEleName()!==b.my&&this.setDirection(h.getRandomDirection()),this.setPosX(e),this.setPosY(s),this.setBlood(this.getBlood()-.01),this.getBlood()>0&&this.getBlood()<=100||this.destroy(),r.innerText=this.getBlood().toPrecision(4)+"",h.addBlink(r),h.renderEle(r,e,s,this.getDirection())):h.renderEle(r,a,i,this.getDirection())}shoot(){var v,g;if(Math.floor(Math.random()*2)+1!==2)return;let e=H["bullet"+this.getLevel()],s=.5,a=this.getWidth()*s,i=this.getHeight()*s,r=this.getPosX(),o=this.getPosY(),l=this.getDirection();({up:()=>{r=r+a/2,o=o-i/2},down:()=>{r=r+a/2,o=o+i/2},left:()=>{r=r-a/2,o=o+i/2},right:()=>{r=r+a/2,o=o+i/2}})[l]();let c=this.game,k=this,y=this.getSpeed()*2,E=100,p=1,P=this.game.renderMapEle(e,a,i,r,o,l,c,k,y,E,p);(g=(v=this.getHtmlEle())==null?void 0:v.parentElement)==null||g.appendChild(P)}upgrade(){this.setLevel(this.getLevel()%5+1),this.setSpeed(this.getSpeed()+.25);let e=this.getHtmlEle(),s=`url(./assets/tank/tank${this.getLevel()}.png)`;e.style.backgroundImage=s}}class X extends Y{destroy(e){var a,i;let s=e==null?void 0:e.parent;if(this.getMapEleName()===t.boss)alert("洗白伊拉克，boss被搞死了");else if(this.getMapEleName()===t.star){s==null||s.upgrade();let r=document.querySelector("#mylevel_content");r.innerHTML=Number(r.innerHTML)+1+""}else this.getMapEleName()===t.star2&&(this.game.randomBullet=!0,setTimeout(()=>{this.game.randomBullet=!1},5e3));d.removeWallFromWallArr(this),(i=(a=this.getHtmlEle())==null?void 0:a.parentElement)==null||i.removeChild(this.getHtmlEle())}move(){}upgrade(){}}var t=(n=>(n.fence="fence",n.wood="wood",n.grass="grass",n.brick="brick",n.iron="iron",n.boss="boss",n.star="start1",n.star2="start2",n))(t||{}),H=(n=>(n.bullet1="bullet1",n.bullet2="bullet2",n.bullet3="bullet3",n.bullet4="bullet4",n.bullet5="bullet5",n))(H||{}),b=(n=>(n.my="my",n.enemy1="tank1",n.enemy2="tank2",n.enemy3="tank3",n.enemy4="tank4",n.enemy5="tank5",n))(b||{});class h{static createHTMLEle(e,s,a,i,r,o,l,m){let c=document.createElement("div");return c.style.cssText=`
            width:${e}vw;
            height:${s}vh;
            left:${a}vw;
            top:${i}vh;
            background:url(./assets/${r});
            background-size:100% 100%;
            background-repeat:no-repeat;
            position:absolute;
            transform:rotate(${o}deg); 
            animation:${l};
            z-index:${m instanceof X?1:2};
        `,c}static createObjEleByMapEleName(e,s,a,i,r,o,l,m,c,k,y){let E,p,v=[[()=>Object.values(t).some(g=>g===e),()=>{let g=new X(a,s,i,r,y,k,o,c,E,m,e,l);return e!=="grass"&&d.pushWallToWallArr(g),g}],[()=>Object.values(b).some(g=>g===e),()=>{let g=.7,A=.2;a=a*g,s=s*g,i=i+s*A,r=r+a*A;let B=new W(a,s,i,r,y,k,o,c,E,m,e,l);return d.pushTankToTankArr(B),B}],[()=>Object.values(H).some(g=>g===e),()=>{let g=new S(a,s,i,r,y,k,o,c,E,m,e,l);return d.pushBulletToBulletArr(g),g}]].find(g=>g[0]());return v&&(p=v[1]()),p}static createAnimationByMapEleName(e){let s="",i=[["boss","dance 1s linear infinite"],["start1","rotate 10s linear infinite"],["start2","rotate 10s linear infinite"],["my","border 10s linear"],["tank1","border 5s linear"],["tank2","border 5s linear"],["tank3","border 5s linear"],["tank4","border 5s linear"],["tank5","border 5s linear"]].find(r=>r[0]===e);return i&&(s=i[1]),s}static addBlink(e){let s=e.classList;s.contains("attack1")?(s.add("attack2"),s.remove("attack1")):(s.add("attack1"),s.remove("attack2"))}static createImgByMapEle(e){let s="",i=[[()=>Object.values(t).some(r=>r===e),()=>`wall/${e}.png`],[()=>Object.values(b).some(r=>r===e),()=>`tank/${e}.png`],[()=>Object.values(H).some(r=>r===e),()=>`bullet/${e}.png`]].find(r=>r[0]());return i&&(s=i[1]()),s}static renderEle(e,s,a,i){let r=h.convertDirectionToDeg(i);e.style.cssText+=`
            transform:rotate(${r}deg); 
            left:${s}vw;
            top:${a}vh;
        `}static convertDirectionToDeg(e){switch(e){case"up":return 0;case"down":return 180;case"left":return-90;case"right":return 90;default:return 0}}static getRandomDirection(){let e=Math.floor(Math.random()*4);return["up","down","left","right"][e]}static isCollision(e,s){return e.getPosX()<s.getPosX()+s.getWidth()&&e.getPosX()+e.getWidth()>s.getPosX()&&e.getPosY()<s.getPosY()+s.getHeight()&&e.getPosY()+e.getHeight()>s.getPosY()}static checkCollision(e,s){let a=[],i=[];e instanceof S?(a=d.getTankArr(),i=d.getBulletArr().filter(l=>l!==e)):e instanceof W&&(a=d.getTankArr().filter(l=>l!==e),i=d.getBulletArr());let r,o=[[l=>l instanceof W,()=>a.forEach(l=>h.isCollision(e,l)&&(r=l))],[l=>l instanceof X,()=>d.getWallArr().forEach(l=>h.isCollision(e,l)&&(r=l))],[l=>l instanceof S,()=>i.forEach(l=>h.isCollision(e,l)&&(r=l))]];return s.forEach(l=>{let m=o.find(c=>c[0](l));m&&m[1]()}),r}static isNotHandleCollisionEle(e,s){let a=!1,r=[[()=>e===(s==null?void 0:s.parent),()=>!0],[()=>e===s,()=>!0],[()=>e.parent&&e.parent===s,()=>!0],[()=>e.parent&&(s==null?void 0:s.parent)&&e.parent===s.parent,()=>!0]].find(o=>o[0]());return r&&(a=r[1]()),a}}class C{constructor(){f(this,"mapArr",[[[b.enemy1,t.grass,t.grass,t.grass,b.enemy2,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,b.enemy4,t.grass,t.grass,b.enemy3],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.brick],[t.brick,t.grass,t.star,t.grass,t.brick,t.grass,t.brick,t.grass,t.brick,t.brick,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.brick],[t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.iron,t.grass,t.grass,t.grass,t.grass,t.grass,t.brick,t.grass],[t.brick,t.grass,t.star2,t.grass,t.brick,t.grass,t.brick,t.brick,t.brick,t.brick,t.brick,t.grass,t.grass,t.grass,t.grass,t.brick,t.brick],[t.brick,t.star,t.brick,t.grass,t.brick,t.grass,t.brick,t.brick,t.iron,t.brick,t.brick,t.grass,t.grass,t.grass,t.brick,t.brick,t.brick],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.grass,t.brick,t.brick,t.brick,t.brick],[t.brick,t.iron,t.iron,t.grass,t.brick,t.grass,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.grass,t.brick,t.brick,t.grass,t.grass],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.brick,t.brick,t.brick,t.grass,t.grass,t.brick,t.grass,t.brick,t.brick,t.grass,t.grass],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.iron,t.grass,t.grass,t.grass,t.grass,t.brick,t.brick,t.brick,t.star,t.grass,t.star],[t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.brick,t.star,t.grass,t.grass,t.brick,t.grass,t.iron,t.grass,t.grass],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.grass,t.brick,t.grass,t.brick,t.grass,t.grass,t.brick,t.brick,t.grass,t.brick,t.brick],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.grass,t.brick,t.grass,t.brick,t.grass,t.grass,t.iron,t.grass,t.grass,t.iron,t.grass],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.brick,t.grass,t.grass,t.grass,t.grass],[t.brick,t.grass,t.star2,t.grass,t.brick,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass],[t.brick,t.grass,t.brick,t.grass,t.brick,t.grass,t.grass,t.brick,t.brick,t.brick,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass],[t.grass,t.grass,t.star,b.enemy1,t.grass,t.grass,b.my,t.brick,t.boss,t.brick,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass,t.grass]]]);f(this,"gameLevel",0);f(this,"mapHeight",100);f(this,"mapWidth",80);f(this,"mapItemWidth",this.mapWidth/this.mapArr[0][0].length);f(this,"mapItemHeight",this.mapHeight/this.mapArr[0].length);f(this,"mapContainerEle",document.querySelector("#container_center"));f(this,"music1");f(this,"music2");f(this,"randomBullet",!1)}init(){this.initMap(),this.initButtonClickEvent(),this.clock()}initMap(){let e=document.createDocumentFragment();this.mapArr[this.gameLevel].forEach((a,i)=>{a.forEach((r,o)=>{let l=o*this.mapItemWidth,m=i*this.mapItemHeight,c=this.mapItemWidth,k=this.mapItemHeight,y="up",E=this,p,P=.25,v=100,g=1,A=this.renderMapEle(r,c,k,l,m,y,E,p,P,v,g);e.appendChild(A)})}),this.mapContainerEle.appendChild(e)}renderMapEle(e,s,a,i,r,o,l,m,c,k,y){let E=h.convertDirectionToDeg(o),p=h.createObjEleByMapEleName(e,s,a,i,r,o,l,m,c,k,y),P=h.createAnimationByMapEleName(e),v=h.createImgByMapEle(e),g=p,A=h.createHTMLEle(p.getWidth(),p.getHeight(),p.getPosX(),p.getPosY(),v,E,P,g);return p.setHtmlEle(A),A}initButtonClickEvent(){document.addEventListener("keypress",e=>{this.music1=new D().createAudio("explosion.mp3"),this.music2=new D().createAudio("attack.mp3");let s=e.code,a=d.getTankArr().find(r=>r.getMapEleName()===b.my),i={KeyW(){a.setDirection("up"),a.move()},KeyD(){a.setDirection("right"),a.move()},KeyS(){a.setDirection("down"),a.move()},KeyA(){a.setDirection("left"),a.move()},Space(){a.shoot()}};i[s]&&i[s]()})}clock(){requestAnimationFrame(()=>{this.update(),this.clock()})}update(){let e=d.getTankArr().filter(a=>a.getMapEleName()!==b.my),s=d.getBulletArr();e.forEach(a=>{a.move()}),s.forEach(a=>{a.move()})}}let M=new C;M.init();
